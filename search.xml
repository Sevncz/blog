<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[mysql分区备份及转移操作]]></title>
      <url>/2017/09/13/mysql%E5%88%86%E5%8C%BA%E5%A4%87%E4%BB%BD%E5%8F%8A%E8%BD%AC%E7%A7%BB%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<p>昨天写的脚本不小心把电量和功率数据弄反了，原始csv文件也被我给删了，悲剧，于是只能通过分区数据备份来转移数据了，意料之外的速度很快，把操作过程记录下。</p>
<ul>
<li><p>快速创建被与原表结构一致的备份表并删除所有分区</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dianliangbak <span class="keyword">LIKE</span> ckr_dau_dianliang;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dianliangbak REMOVE PARTITIONING;</div></pre></td></tr></table></figure>
</li>
<li><p>将分区表数据转移至被分表<figure class="highlight plain"><figcaption><span>TABLE ckr_dau_dianliang EXCHANGE PARTITION p20170913 WITH TABLE dianliangbak;```  这一步操作之后，该分区数据被清空。</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 检查分区数据 ```select count(1) from ckr_dau_dianliang partition(p20170913);</div></pre></td></tr></table></figure></p>
</li>
<li><p>针对功率表重复以上操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> gonglvbak <span class="keyword">LIKE</span> ckr_dau_gonglv;</div><div class="line"></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> gonglvbak REMOVE PARTITIONING;</div><div class="line"></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ckr_dau_gonglv <span class="keyword">EXCHANGE</span> <span class="keyword">PARTITION</span> p20170913 <span class="keyword">WITH</span> <span class="keyword">TABLE</span> gonglvbak;</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> ckr_dau_gonglv <span class="keyword">partition</span>(p20170913);</div></pre></td></tr></table></figure>
</li>
<li><p>恢复数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> ckr_dau_dianliang (devId, <span class="keyword">time</span>, <span class="keyword">value</span>) <span class="keyword">select</span> devId, <span class="keyword">time</span>, <span class="keyword">value</span> <span class="keyword">from</span> gonglvbak;</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> ckr_dau_gonglv (devId, <span class="keyword">time</span>, <span class="keyword">value</span>) <span class="keyword">select</span> devId, <span class="keyword">time</span>, <span class="keyword">value</span> <span class="keyword">from</span> dianliangbak;</div><div class="line"></div><div class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> dianliangbak;</div><div class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> gonglvbak;</div></pre></td></tr></table></figure>
<p>​</p>
<p>可以用来作为未来分区数据清理并备份的方法之一。</p>
</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/09/08/hello-world/</url>
      <content type="html"><![CDATA[<p>终于把这个在线笔记本搭起来了。</p>
<p>以前用过 Mac 自带的 Notes、印象笔记、OneNote，都挺不好用的，要不就是同步不方便，要不就是排版不方便，现在习惯用markdown来写技术文档，索性把笔记也改成 markdown 好了，而且还自带 github 备份，所以有空了把以前的笔记整理整理放上来，希望自己的懒癌不要发作～</p>
]]></content>
      
        
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[关于]]></title>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[<ul>
<li><p>北京</p>
</li>
<li><p>本科</p>
</li>
<li><p>2011年毕业</p>
</li>
<li><p>主要从事 java 和 python 相关开发工作</p>
<p>​</p>
</li>
</ul>
]]></content>
    </entry>
    
  
</search>
